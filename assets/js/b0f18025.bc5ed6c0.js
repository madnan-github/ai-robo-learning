"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[369],{2300:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"module-1/chapter-4/services-actions","title":"Services and Actions","description":"This chapter covers two important communication patterns in ROS 2: services for synchronous request-response communication and actions for long-running tasks with feedback.","source":"@site/docs/module-1/chapter-4/services-actions.md","sourceDirName":"module-1/chapter-4","slug":"/module-1/chapter-4/services-actions","permalink":"/ai-robo-learning/docs/module-1/chapter-4/services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/madnan-github/ai-robo-learning/docs/module-1/chapter-4/services-actions.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Services and Actions"},"sidebar":"tutorialSidebar","previous":{"title":"Topics and Message Passing","permalink":"/ai-robo-learning/docs/module-1/chapter-3/topics-message-passing"},"next":{"title":"rclpy and Python Integration","permalink":"/ai-robo-learning/docs/module-1/chapter-5/rclpy-integration"}}');var r=i(4848),t=i(8453);const a={sidebar_position:4,title:"Services and Actions"},c="Services and Actions",l={},o=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Understanding Services",id:"understanding-services",level:2},{value:"Service Architecture",id:"service-architecture",level:3},{value:"Creating Services",id:"creating-services",level:2},{value:"Service Server Example",id:"service-server-example",level:3},{value:"Service Client Example",id:"service-client-example",level:3},{value:"Understanding Actions",id:"understanding-actions",level:2},{value:"Action Architecture",id:"action-architecture",level:3},{value:"Creating Actions",id:"creating-actions",level:2},{value:"Action Server Example",id:"action-server-example",level:3},{value:"Action Client Example",id:"action-client-example",level:3},{value:"Hands-on Lab: Robot Navigation Service and Action",id:"hands-on-lab-robot-navigation-service-and-action",level:2},{value:"Step 1: Create the Robot Command Service",id:"step-1-create-the-robot-command-service",level:3},{value:"Step 2: Create the Navigation Action",id:"step-2-create-the-navigation-action",level:3},{value:"Step 3: Test the Services and Actions",id:"step-3-test-the-services-and-actions",level:3},{value:"When to Use Each Communication Pattern",id:"when-to-use-each-communication-pattern",level:2},{value:"Use Topics When:",id:"use-topics-when",level:3},{value:"Use Services When:",id:"use-services-when",level:3},{value:"Use Actions When:",id:"use-actions-when",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"services-and-actions",children:"Services and Actions"})}),"\n",(0,r.jsx)(n.p,{children:"This chapter covers two important communication patterns in ROS 2: services for synchronous request-response communication and actions for long-running tasks with feedback."}),"\n",(0,r.jsx)(n.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,r.jsx)(n.p,{children:"In this chapter, you'll explore:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ROS 2 services and synchronous communication"}),"\n",(0,r.jsx)(n.li,{children:"Creating service servers and clients"}),"\n",(0,r.jsx)(n.li,{children:"ROS 2 actions for long-running tasks"}),"\n",(0,r.jsx)(n.li,{children:"Creating action servers and clients"}),"\n",(0,r.jsx)(n.li,{children:"When to use services vs. actions vs. topics"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Completion of Module 1, Chapters 1-3"}),"\n",(0,r.jsx)(n.li,{children:"Basic Python programming knowledge"}),"\n",(0,r.jsx)(n.li,{children:"ROS 2 Humble installed on your system"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"understanding-services",children:"Understanding Services"}),"\n",(0,r.jsx)(n.p,{children:"Services provide synchronous communication between nodes using a request-response pattern:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Service clients send requests to service servers"}),"\n",(0,r.jsx)(n.li,{children:"Service servers process requests and return responses"}),"\n",(0,r.jsx)(n.li,{children:"Communication is blocking - the client waits for a response"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-architecture",children:"Service Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[Client] --(Request)--\x3e [Service Server] --(Response)--\x3e [Client]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"creating-services",children:"Creating Services"}),"\n",(0,r.jsx)(n.h3,{id:"service-server-example",children:"Service Server Example"}),"\n",(0,r.jsxs)(n.p,{children:["First, let's create a simple math service that adds two numbers. Create the service definition file ",(0,r.jsx)(n.code,{children:"AddTwoInts.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now create the service server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalService(Node):\n\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_service = MinimalService()\n\n    rclpy.spin(minimal_service)\n\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-client-example",children:"Service Client Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\nimport sys\n\nclass MinimalClient(Node):\n\n    def __init__(self):\n        super().__init__('minimal_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_client = MinimalClient()\n    response = minimal_client.send_request(int(sys.argv[1]), int(sys.argv[2]))\n\n    minimal_client.get_logger().info(\n        f'Result of {sys.argv[1]} + {sys.argv[2]} = {response.sum}')\n\n    minimal_client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"understanding-actions",children:"Understanding Actions"}),"\n",(0,r.jsx)(n.p,{children:"Actions are used for long-running tasks that require:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Goal specification"}),"\n",(0,r.jsx)(n.li,{children:"Continuous feedback"}),"\n",(0,r.jsx)(n.li,{children:"Result reporting"}),"\n",(0,r.jsx)(n.li,{children:"Cancellation capability"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"action-architecture",children:"Action Architecture"}),"\n",(0,r.jsx)(n.p,{children:"Actions have three parts:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Goal"}),": What the action should do"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Progress updates during execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Result"}),": Final outcome when complete"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"creating-actions",children:"Creating Actions"}),"\n",(0,r.jsx)(n.h3,{id:"action-server-example",children:"Action Server Example"}),"\n",(0,r.jsx)(n.p,{children:"Let's create a Fibonacci action server:"}),"\n",(0,r.jsxs)(n.p,{children:["First, create the action definition file ",(0,r.jsx)(n.code,{children:"Fibonacci.action"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int32 order\n---\nint32[] sequence\n---\nint32[] partial_sequence\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now create the action server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\nfrom rclpy.executors import MultiThreadedExecutor\nfrom rclpy.callback_groups import ReentrantCallbackGroup\nimport time\n\nclass FibonacciActionServer(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            execute_callback=self.execute_callback,\n            callback_group=ReentrantCallbackGroup(),\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback)\n\n    def goal_callback(self, goal_request):\n        self.get_logger().info('Received goal request')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.partial_sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.partial_sequence.append(\n                feedback_msg.partial_sequence[i] + feedback_msg.partial_sequence[i-1])\n\n            self.get_logger().info(f'Publishing feedback: {feedback_msg.partial_sequence}')\n            goal_handle.publish_feedback(feedback_msg)\n            time.sleep(1)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.partial_sequence\n        self.get_logger().info(f'Returning result: {result.sequence}')\n\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    fibonacci_action_server = FibonacciActionServer()\n\n    try:\n        executor = MultiThreadedExecutor()\n        rclpy.spin(fibonacci_action_server, executor=executor)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        fibonacci_action_server.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"action-client-example",children:"Action Client Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci')\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Received feedback: {feedback.partial_sequence}')\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n        rclpy.shutdown()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = FibonacciActionClient()\n\n    action_client.send_goal(10)\n\n    rclpy.spin(action_client)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"hands-on-lab-robot-navigation-service-and-action",children:"Hands-on Lab: Robot Navigation Service and Action"}),"\n",(0,r.jsx)(n.p,{children:"In this lab, you'll create both a service for immediate robot commands and an action for navigation tasks."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-the-robot-command-service",children:"Step 1: Create the Robot Command Service"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"robot_command_service.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import SetBool\nimport random\n\nclass RobotCommandService(Node):\n\n    def __init__(self):\n        super().__init__('robot_command_service')\n        self.srv = self.create_service(\n            SetBool,\n            'robot_enable',\n            self.enable_robot_callback)\n        self.robot_enabled = False\n\n    def enable_robot_callback(self, request, response):\n        self.robot_enabled = request.data\n        if self.robot_enabled:\n            self.get_logger().info('Robot enabled')\n            response.success = True\n            response.message = 'Robot enabled successfully'\n        else:\n            self.get_logger().info('Robot disabled')\n            response.success = True\n            response.message = 'Robot disabled successfully'\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    robot_service = RobotCommandService()\n\n    try:\n        rclpy.spin(robot_service)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        robot_service.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-the-navigation-action",children:"Step 2: Create the Navigation Action"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"navigation_action.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom rclpy.executors import MultiThreadedExecutor\nfrom rclpy.callback_groups import ReentrantCallbackGroup\nimport time\n\nclass NavigationGoal:\n    def __init__(self, x=0.0, y=0.0, theta=0.0):\n        self.x = x\n        self.y = y\n        self.theta = theta\n\nclass NavigationResult:\n    def __init__(self, success=False, message=\"\"):\n        self.success = success\n        self.message = message\n\nclass NavigationActionServer(Node):\n\n    def __init__(self):\n        super().__init__('navigation_action_server')\n        # Using a custom action since we don't have a specific navigation action type\n        # In a real scenario, you would use nav2_msgs or similar\n        self.get_logger().info('Navigation action server initialized')\n\n    def execute_navigation(self, goal):\n        self.get_logger().info(f'Navigating to position: ({goal.x}, {goal.y})')\n\n        # Simulate navigation with feedback\n        for i in range(10):\n            self.get_logger().info(f'Navigating... {i*10}% complete')\n            time.sleep(0.5)  # Simulate navigation time\n\n        # Simulate success/failure\n        success = random.choice([True, True, True, True, False])  # 80% success rate\n\n        result = NavigationResult()\n        if success:\n            result.success = True\n            result.message = f'Reached goal position ({goal.x}, {goal.y})'\n            self.get_logger().info(result.message)\n        else:\n            result.success = False\n            result.message = f'Failed to reach goal position ({goal.x}, {goal.y})'\n            self.get_logger().error(result.message)\n\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    nav_server = NavigationActionServer()\n\n    try:\n        executor = MultiThreadedExecutor()\n        rclpy.spin(nav_server, executor=executor)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        nav_server.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-test-the-services-and-actions",children:"Step 3: Test the Services and Actions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Start the service:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\npython3 robot_command_service.py\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Test the service from another terminal:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 service call /robot_enable std_srvs/srv/SetBool "{data: true}"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-each-communication-pattern",children:"When to Use Each Communication Pattern"}),"\n",(0,r.jsx)(n.h3,{id:"use-topics-when",children:"Use Topics When:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Data needs to be broadcast to multiple subscribers"}),"\n",(0,r.jsx)(n.li,{children:"Communication can be asynchronous"}),"\n",(0,r.jsx)(n.li,{children:"Real-time performance is important"}),"\n",(0,r.jsx)(n.li,{children:"Data is continuously flowing"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-services-when",children:"Use Services When:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request-response pattern is needed"}),"\n",(0,r.jsx)(n.li,{children:"Operation is relatively quick"}),"\n",(0,r.jsx)(n.li,{children:"Synchronous communication is acceptable"}),"\n",(0,r.jsx)(n.li,{children:"Need to perform a specific task once"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-actions-when",children:"Use Actions When:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Task takes a long time to complete"}),"\n",(0,r.jsx)(n.li,{children:"Need to provide feedback during execution"}),"\n",(0,r.jsx)(n.li,{children:"Task might need to be canceled"}),"\n",(0,r.jsx)(n.li,{children:"Need to track progress of a goal"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Design"}),": Keep service calls short and focused"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Action Design"}),": Use actions for tasks that take more than a few seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Error Handling"}),": Implement proper error handling in both services and actions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cancellation"}),": Support cancellation in actions when appropriate"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Feedback"}),": Provide meaningful feedback in actions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"After completing this chapter, you'll be ready to learn about integrating Python agents with ROS controllers using rclpy in Chapter 5."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var s=i(6540);const r={},t=s.createContext(r);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);