"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[295],{7738:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-2/chapter-5/unity-integration","title":"Unity Integration","description":"This chapter covers integrating Unity for high-fidelity rendering and human-robot interaction in simulation. Unity provides photorealistic environments and advanced graphics capabilities that complement Gazebo\'s physics simulation.","source":"@site/docs/module-2/chapter-5/unity-integration.md","sourceDirName":"module-2/chapter-5","slug":"/module-2/chapter-5/unity-integration","permalink":"/ai-robo-learning/ur/docs/module-2/chapter-5/unity-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/madnan-github/ai-robo-learning/docs/module-2/chapter-5/unity-integration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Unity Integration"},"sidebar":"tutorialSidebar","previous":{"title":"Sensor Simulation","permalink":"/ai-robo-learning/ur/docs/module-2/chapter-4/sensor-simulation"},"next":{"title":"Environment Building","permalink":"/ai-robo-learning/ur/docs/module-2/chapter-6/environment-building"}}');var o=t(4848),r=t(8453);const a={sidebar_position:5,title:"Unity Integration"},s="Unity Integration",l={},c=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Understanding Unity for Robotics",id:"understanding-unity-for-robotics",level:2},{value:"Unity vs Gazebo Comparison",id:"unity-vs-gazebo-comparison",level:3},{value:"Setting Up Unity for Robotics",id:"setting-up-unity-for-robotics",level:2},{value:"Installing Unity Robotics Package",id:"installing-unity-robotics-package",level:3},{value:"ROS TCP Connector",id:"ros-tcp-connector",level:3},{value:"Creating a Unity Robot Model",id:"creating-a-unity-robot-model",level:2},{value:"Importing Robot Models",id:"importing-robot-models",level:3},{value:"Basic Robot Controller in Unity",id:"basic-robot-controller-in-unity",level:3},{value:"Sensor Simulation in Unity",id:"sensor-simulation-in-unity",level:2},{value:"Camera Sensor",id:"camera-sensor",level:3},{value:"IMU Sensor",id:"imu-sensor",level:3},{value:"Creating Photorealistic Environments",id:"creating-photorealistic-environments",level:2},{value:"Environment Setup",id:"environment-setup",level:3},{value:"Material and Lighting Setup",id:"material-and-lighting-setup",level:3},{value:"Human-Robot Interaction in Unity",id:"human-robot-interaction-in-unity",level:2},{value:"VR/AR Interaction Setup",id:"vrar-interaction-setup",level:3},{value:"Unity-Gazebo Hybrid Simulation",id:"unity-gazebo-hybrid-simulation",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Synchronization Code",id:"synchronization-code",level:3},{value:"Hands-on Lab: Unity Humanoid Robot Simulation",id:"hands-on-lab-unity-humanoid-robot-simulation",level:2},{value:"Step 1: Create Unity Project",id:"step-1-create-unity-project",level:3},{value:"Step 2: Create Robot Model",id:"step-2-create-robot-model",level:3},{value:"Step 3: Add Robot Controller Script",id:"step-3-add-robot-controller-script",level:3},{value:"Step 4: Create a ROS Bridge Node",id:"step-4-create-a-ros-bridge-node",level:3},{value:"Step 5: Test the Integration",id:"step-5-test-the-integration",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"unity-integration",children:"Unity Integration"})}),"\n",(0,o.jsx)(e.p,{children:"This chapter covers integrating Unity for high-fidelity rendering and human-robot interaction in simulation. Unity provides photorealistic environments and advanced graphics capabilities that complement Gazebo's physics simulation."}),"\n",(0,o.jsx)(e.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,o.jsx)(e.p,{children:"In this chapter, you'll explore:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Unity robotics simulation concepts"}),"\n",(0,o.jsx)(e.li,{children:"Setting up Unity for robotics simulation"}),"\n",(0,o.jsx)(e.li,{children:"ROS 2 integration with Unity"}),"\n",(0,o.jsx)(e.li,{children:"Creating photorealistic environments"}),"\n",(0,o.jsx)(e.li,{children:"Human-robot interaction in Unity"}),"\n",(0,o.jsx)(e.li,{children:"Comparing Unity vs Gazebo for different use cases"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Completion of Module 1 and 2, Chapters 1-4"}),"\n",(0,o.jsx)(e.li,{children:"Basic Unity knowledge (optional but helpful)"}),"\n",(0,o.jsx)(e.li,{children:"ROS 2 Humble installed"}),"\n",(0,o.jsx)(e.li,{children:"Understanding of 3D graphics concepts"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"understanding-unity-for-robotics",children:"Understanding Unity for Robotics"}),"\n",(0,o.jsx)(e.p,{children:"Unity is a powerful game engine that can be adapted for robotics simulation. It excels at:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Photorealistic rendering"}),"\n",(0,o.jsx)(e.li,{children:"Complex visual environments"}),"\n",(0,o.jsx)(e.li,{children:"Human-robot interaction scenarios"}),"\n",(0,o.jsx)(e.li,{children:"VR/AR applications"}),"\n",(0,o.jsx)(e.li,{children:"Advanced lighting and materials"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"unity-vs-gazebo-comparison",children:"Unity vs Gazebo Comparison"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"Feature"}),(0,o.jsx)(e.th,{children:"Unity"}),(0,o.jsx)(e.th,{children:"Gazebo"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"Rendering Quality"}),(0,o.jsx)(e.td,{children:"Photorealistic"}),(0,o.jsx)(e.td,{children:"Good for visualization"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"Physics Simulation"}),(0,o.jsx)(e.td,{children:"Basic (Unity Physics)"}),(0,o.jsx)(e.td,{children:"Advanced (ODE, Bullet, DART)"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"ROS Integration"}),(0,o.jsx)(e.td,{children:"Unity Robotics Package"}),(0,o.jsx)(e.td,{children:"Native integration"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"Performance"}),(0,o.jsx)(e.td,{children:"Optimized for graphics"}),(0,o.jsx)(e.td,{children:"Optimized for physics"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:"Learning Curve"}),(0,o.jsx)(e.td,{children:"Steeper"}),(0,o.jsx)(e.td,{children:"Moderate"})]})]})]}),"\n",(0,o.jsx)(e.h2,{id:"setting-up-unity-for-robotics",children:"Setting Up Unity for Robotics"}),"\n",(0,o.jsx)(e.h3,{id:"installing-unity-robotics-package",children:"Installing Unity Robotics Package"}),"\n",(0,o.jsx)(e.p,{children:"The Unity Robotics Package provides:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"ROS communication via TCP/IP"}),"\n",(0,o.jsx)(e.li,{children:"Sensor simulation (camera, LiDAR, IMU)"}),"\n",(0,o.jsx)(e.li,{children:"Robot control interfaces"}),"\n",(0,o.jsx)(e.li,{children:"Sample scenes and examples"}),"\n"]}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Install Unity Hub and Unity 2021.3 LTS or later"}),"\n",(0,o.jsx)(e.li,{children:"Create a new 3D project"}),"\n",(0,o.jsx)(e.li,{children:"Install the Unity Robotics Package via Package Manager"}),"\n",(0,o.jsx)(e.li,{children:"Install the ROS TCP Connector"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"ros-tcp-connector",children:"ROS TCP Connector"}),"\n",(0,o.jsx)(e.p,{children:"The ROS TCP Connector enables communication between Unity and ROS 2:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\nusing RosSharp;\n\npublic class UnityRobotController : MonoBehaviour\n{\n    public string rosIPAddress = "127.0.0.1";\n    public int rosPort = 10000;\n\n    private RosSocket rosSocket;\n\n    void Start()\n    {\n        // Connect to ROS\n        rosSocket = new RosSocket(new RosSharp.Communication.Protocol.WebSocket(rosIPAddress, rosPort));\n    }\n\n    void OnDestroy()\n    {\n        rosSocket.Close();\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"creating-a-unity-robot-model",children:"Creating a Unity Robot Model"}),"\n",(0,o.jsx)(e.h3,{id:"importing-robot-models",children:"Importing Robot Models"}),"\n",(0,o.jsx)(e.p,{children:"Unity can import robot models in various formats:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"FBX"}),": Most common format for 3D models"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"URDF"}),": Through Unity Robotics Package"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"STL"}),": Simple 3D models"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"OBJ"}),": Wavefront OBJ format"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"basic-robot-controller-in-unity",children:"Basic Robot Controller in Unity"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\nusing RosSharp;\n\npublic class UnityRobotController : MonoBehaviour\n{\n    [Header("Joint Control")]\n    public Transform leftHip;\n    public Transform leftKnee;\n    public Transform rightHip;\n    public Transform rightKnee;\n    public Transform leftShoulder;\n    public Transform leftElbow;\n    public Transform rightShoulder;\n    public Transform rightElbow;\n\n    [Header("ROS Connection")]\n    public string rosIPAddress = "127.0.0.1";\n    public int rosPort = 10000;\n\n    private RosSocket rosSocket;\n    private JointStatePublisher jointStatePublisher;\n    private JointStateSubscriber jointStateSubscriber;\n\n    void Start()\n    {\n        // Initialize ROS connection\n        rosSocket = new RosSocket(new RosSharp.Communication.Protocol.WebSocket(rosIPAddress, rosPort));\n\n        // Initialize publishers and subscribers\n        jointStatePublisher = new JointStatePublisher(rosSocket, "/joint_states");\n        jointStateSubscriber = new JointStateSubscriber(rosSocket, "/joint_commands", OnJointCommandsReceived);\n    }\n\n    void Update()\n    {\n        // Publish current joint states\n        PublishJointStates();\n    }\n\n    void OnJointCommandsReceived(float[] positions)\n    {\n        // Apply joint commands to robot\n        if (positions.Length >= 8)\n        {\n            leftHip.localRotation = Quaternion.Euler(0, 0, positions[0] * Mathf.Rad2Deg);\n            leftKnee.localRotation = Quaternion.Euler(0, 0, positions[1] * Mathf.Rad2Deg);\n            rightHip.localRotation = Quaternion.Euler(0, 0, positions[2] * Mathf.Rad2Deg);\n            rightKnee.localRotation = Quaternion.Euler(0, 0, positions[3] * Mathf.Rad2Deg);\n            leftShoulder.localRotation = Quaternion.Euler(positions[4] * Mathf.Rad2Deg, 0, 0);\n            leftElbow.localRotation = Quaternion.Euler(positions[5] * Mathf.Rad2Deg, 0, 0);\n            rightShoulder.localRotation = Quaternion.Euler(positions[6] * Mathf.Rad2Deg, 0, 0);\n            rightElbow.localRotation = Quaternion.Euler(positions[7] * Mathf.Rad2Deg, 0, 0);\n        }\n    }\n\n    void PublishJointStates()\n    {\n        // Get current joint positions and publish\n        float[] currentPositions = {\n            leftHip.localEulerAngles.z * Mathf.Deg2Rad,\n            leftKnee.localEulerAngles.z * Mathf.Deg2Rad,\n            rightHip.localEulerAngles.z * Mathf.Deg2Rad,\n            rightKnee.localEulerAngles.z * Mathf.Deg2Rad,\n            leftShoulder.localEulerAngles.x * Mathf.Deg2Rad,\n            leftElbow.localEulerAngles.x * Mathf.Deg2Rad,\n            rightShoulder.localEulerAngles.x * Mathf.Deg2Rad,\n            rightElbow.localEulerAngles.x * Mathf.Deg2Rad\n        };\n\n        jointStatePublisher.Publish(currentPositions);\n    }\n\n    void OnDestroy()\n    {\n        rosSocket?.Close();\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"sensor-simulation-in-unity",children:"Sensor Simulation in Unity"}),"\n",(0,o.jsx)(e.h3,{id:"camera-sensor",children:"Camera Sensor"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing RosSharp;\n\npublic class UnityCameraSensor : MonoBehaviour\n{\n    public Camera cameraComponent;\n    public string topicName = "/unity_camera/image_raw";\n    public int imageWidth = 640;\n    public int imageHeight = 480;\n    public float updateRate = 30.0f;\n\n    private SensorPublisher sensorPublisher;\n    private float updateInterval;\n    private float lastUpdateTime;\n\n    void Start()\n    {\n        updateInterval = 1.0f / updateRate;\n        lastUpdateTime = 0;\n\n        // Initialize sensor publisher\n        sensorPublisher = new SensorPublisher(rosSocket, topicName);\n    }\n\n    void Update()\n    {\n        if (Time.time - lastUpdateTime >= updateInterval)\n        {\n            CaptureAndPublishImage();\n            lastUpdateTime = Time.time;\n        }\n    }\n\n    void CaptureAndPublishImage()\n    {\n        // Capture image from camera\n        RenderTexture currentRT = RenderTexture.active;\n        RenderTexture.active = cameraComponent.targetTexture;\n\n        cameraComponent.Render();\n\n        Texture2D imageTexture = new Texture2D(imageWidth, imageHeight, TextureFormat.RGB24, false);\n        imageTexture.ReadPixels(new Rect(0, 0, imageWidth, imageHeight), 0, 0);\n        imageTexture.Apply();\n\n        RenderTexture.active = currentRT;\n\n        // Convert to ROS image format and publish\n        byte[] imageData = imageTexture.EncodeToJPG();\n        sensorPublisher.PublishImage(imageData, imageWidth, imageHeight, "rgb8");\n\n        Destroy(imageTexture);\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"imu-sensor",children:"IMU Sensor"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing RosSharp;\n\npublic class UnityImuSensor : MonoBehaviour\n{\n    public string topicName = "/unity_imu/data";\n    public float updateRate = 100.0f;\n\n    private SensorPublisher sensorPublisher;\n    private float updateInterval;\n    private float lastUpdateTime;\n\n    void Start()\n    {\n        updateInterval = 1.0f / updateRate;\n        lastUpdateTime = 0;\n\n        sensorPublisher = new SensorPublisher(rosSocket, topicName);\n    }\n\n    void Update()\n    {\n        if (Time.time - lastUpdateTime >= updateInterval)\n        {\n            PublishImuData();\n            lastUpdateTime = Time.time;\n        }\n    }\n\n    void PublishImuData()\n    {\n        // Get linear acceleration (from physics or simulated)\n        Vector3 linearAcc = GetComponent<Rigidbody>().velocity / Time.fixedDeltaTime;\n\n        // Get angular velocity\n        Vector3 angularVel = GetComponent<Rigidbody>().angularVelocity;\n\n        // Create and publish IMU message\n        sensorPublisher.PublishImu(\n            transform.rotation,\n            angularVel,\n            linearAcc\n        );\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"creating-photorealistic-environments",children:"Creating Photorealistic Environments"}),"\n",(0,o.jsx)(e.h3,{id:"environment-setup",children:"Environment Setup"}),"\n",(0,o.jsx)(e.p,{children:"Unity excels at creating photorealistic environments:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\n\npublic class EnvironmentManager : MonoBehaviour\n{\n    [Header("Lighting")]\n    public Light sunLight;\n    public float dayNightCycleSpeed = 0.1f;\n    private float timeOfDay = 0.5f; // 0 = midnight, 0.5 = noon, 1 = midnight\n\n    [Header("Weather")]\n    public GameObject rainSystem;\n    public GameObject fogSystem;\n\n    void Update()\n    {\n        UpdateDayNightCycle();\n    }\n\n    void UpdateDayNightCycle()\n    {\n        timeOfDay += dayNightCycleSpeed * Time.deltaTime;\n        if (timeOfDay > 1) timeOfDay = 0;\n\n        // Rotate sun based on time of day\n        float sunAngle = timeOfDay * 360f - 90f;\n        sunLight.transform.rotation = Quaternion.Euler(sunAngle, 0, 0);\n\n        // Adjust lighting intensity based on sun angle\n        float intensity = Mathf.Clamp01(Mathf.Cos(Mathf.Deg2Rad * sunAngle));\n        sunLight.intensity = Mathf.Lerp(0.1f, 1f, intensity);\n    }\n\n    public void SetWeather(string weatherType)\n    {\n        switch (weatherType)\n        {\n            case "rain":\n                rainSystem.SetActive(true);\n                fogSystem.SetActive(false);\n                break;\n            case "fog":\n                rainSystem.SetActive(false);\n                fogSystem.SetActive(true);\n                break;\n            case "clear":\n                rainSystem.SetActive(false);\n                fogSystem.SetActive(false);\n                break;\n        }\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"material-and-lighting-setup",children:"Material and Lighting Setup"}),"\n",(0,o.jsx)(e.p,{children:"For photorealistic rendering, configure materials properly:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\n\npublic class MaterialSetup : MonoBehaviour\n{\n    [Header("Robot Materials")]\n    public Material robotBodyMaterial;\n    public Material robotJointMaterial;\n    public Material sensorMaterial;\n\n    [Header("Environment Materials")]\n    public Material floorMaterial;\n    public Material wallMaterial;\n\n    void Start()\n    {\n        SetupRobotMaterials();\n        SetupEnvironmentMaterials();\n    }\n\n    void SetupRobotMaterials()\n    {\n        // Robot body material (metallic surface)\n        robotBodyMaterial.SetFloat("_Metallic", 0.7f);\n        robotBodyMaterial.SetFloat("_Smoothness", 0.8f);\n\n        // Robot joint material (slightly different for visual distinction)\n        robotJointMaterial.SetFloat("_Metallic", 0.5f);\n        robotJointMaterial.SetFloat("_Smoothness", 0.6f);\n\n        // Sensor material (transparent for visual identification)\n        sensorMaterial.SetFloat("_Metallic", 0.2f);\n        sensorMaterial.SetFloat("_Smoothness", 0.9f);\n        sensorMaterial.SetFloat("_Surface", 1); // Transparent\n        sensorMaterial.SetColor("_BaseColor", new Color(0, 0.8f, 1, 0.5f));\n    }\n\n    void SetupEnvironmentMaterials()\n    {\n        // Floor material (concrete or tile)\n        floorMaterial.SetFloat("_Metallic", 0.1f);\n        floorMaterial.SetFloat("_Smoothness", 0.3f);\n\n        // Wall material (paint or plaster)\n        wallMaterial.SetFloat("_Metallic", 0.0f);\n        wallMaterial.SetFloat("_Smoothness", 0.2f);\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"human-robot-interaction-in-unity",children:"Human-Robot Interaction in Unity"}),"\n",(0,o.jsx)(e.h3,{id:"vrar-interaction-setup",children:"VR/AR Interaction Setup"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing UnityEngine.XR;\n\npublic class HumanRobotInteraction : MonoBehaviour\n{\n    [Header("Interaction Setup")]\n    public Transform humanHead;\n    public Transform[] interactionPoints;\n    public LayerMask interactionLayer;\n\n    [Header("Gestures")]\n    public bool detectGestures = true;\n    public float gestureDetectionRadius = 2.0f;\n\n    void Update()\n    {\n        if (detectGestures)\n        {\n            DetectGestures();\n        }\n\n        HandleInteractions();\n    }\n\n    void DetectGestures()\n    {\n        // Detect hand gestures in the interaction radius\n        Collider[] nearbyObjects = Physics.OverlapSphere(humanHead.position, gestureDetectionRadius, interactionLayer);\n\n        foreach (Collider col in nearbyObjects)\n        {\n            if (IsGestureDetected(col))\n            {\n                TriggerInteraction(col);\n            }\n        }\n    }\n\n    bool IsGestureDetected(Collider target)\n    {\n        // Simple gesture detection logic\n        // In practice, this would use more sophisticated hand tracking\n        Vector3 directionToTarget = (target.transform.position - humanHead.position).normalized;\n        float angleToTarget = Vector3.Angle(humanHead.forward, directionToTarget);\n\n        // Detect if user is looking at and gesturing toward the target\n        return angleToTarget < 30f; // Within 30-degree cone\n    }\n\n    void TriggerInteraction(Collider target)\n    {\n        // Send interaction command to ROS\n        // This could be a custom message type\n        string interactionCommand = $"INTERACT:{target.name}";\n\n        // Publish to ROS topic\n        // rosSocket.Publish("/interaction_commands", interactionCommand);\n    }\n\n    void HandleInteractions()\n    {\n        // Handle direct interactions (keyboard, mouse, VR controllers)\n        if (Input.GetKeyDown(KeyCode.Space))\n        {\n            // Send command to robot\n            SendRobotCommand("STOP");\n        }\n        else if (Input.GetKeyDown(KeyCode.UpArrow))\n        {\n            SendRobotCommand("FORWARD");\n        }\n        else if (Input.GetKeyDown(KeyCode.LeftArrow))\n        {\n            SendRobotCommand("LEFT");\n        }\n        else if (Input.GetKeyDown(KeyCode.RightArrow))\n        {\n            SendRobotCommand("RIGHT");\n        }\n    }\n\n    void SendRobotCommand(string command)\n    {\n        // Send command to ROS system\n        // rosSocket.Publish("/robot_commands", command);\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"unity-gazebo-hybrid-simulation",children:"Unity-Gazebo Hybrid Simulation"}),"\n",(0,o.jsx)(e.p,{children:"For the best of both worlds, you can combine Unity's rendering with Gazebo's physics:"}),"\n",(0,o.jsx)(e.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"[Unity (Rendering)] <---\x3e [ROS Bridge] <---\x3e [Gazebo (Physics)]\n      |                       |                     |\n[High-quality visuals]  [Real-time data]  [Accurate physics]\n"})}),"\n",(0,o.jsx)(e.h3,{id:"synchronization-code",children:"Synchronization Code"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing RosSharp;\n\npublic class UnityGazeboSync : MonoBehaviour\n{\n    [Header("Synchronization")]\n    public string gazeboJointStatesTopic = "/joint_states";\n    public string unityCommandTopic = "/unity_robot_commands";\n\n    private JointStateSubscriber gazeboJointStateSubscriber;\n    private JointStatePublisher unityJointStatePublisher;\n\n    private Dictionary<string, Transform> jointMap;\n\n    void Start()\n    {\n        InitializeJointMap();\n        InitializeRosConnections();\n    }\n\n    void InitializeJointMap()\n    {\n        // Map joint names to Unity transforms\n        jointMap = new Dictionary<string, Transform>\n        {\n            {"left_hip", FindJoint("LeftHip")},\n            {"left_knee", FindJoint("LeftKnee")},\n            {"right_hip", FindJoint("RightHip")},\n            {"right_knee", FindJoint("RightKnee")},\n            {"left_shoulder", FindJoint("LeftShoulder")},\n            {"left_elbow", FindJoint("LeftElbow")},\n            {"right_shoulder", FindJoint("RightShoulder")},\n            {"right_elbow", FindJoint("RightElbow")}\n        };\n    }\n\n    Transform FindJoint(string jointName)\n    {\n        Transform[] allChildren = GetComponentsInChildren<Transform>();\n        foreach (Transform child in allChildren)\n        {\n            if (child.name.Contains(jointName, System.StringComparison.OrdinalIgnoreCase))\n                return child;\n        }\n        return null;\n    }\n\n    void InitializeRosConnections()\n    {\n        // Subscribe to Gazebo joint states\n        gazeboJointStateSubscriber = new JointStateSubscriber(rosSocket, gazeboJointStatesTopic, OnGazeboJointStatesReceived);\n\n        // Publish Unity joint states\n        unityJointStatePublisher = new JointStatePublisher(rosSocket, unityCommandTopic);\n    }\n\n    void OnGazeboJointStatesReceived(string[] jointNames, float[] positions, float[] velocities, float[] efforts)\n    {\n        // Update Unity robot model based on Gazebo physics\n        for (int i = 0; i < jointNames.Length && i < positions.Length; i++)\n        {\n            if (jointMap.ContainsKey(jointNames[i]))\n            {\n                Transform joint = jointMap[jointNames[i]];\n\n                // Apply position based on joint type\n                // For revolute joints, apply rotation\n                joint.localRotation = Quaternion.Euler(0, 0, positions[i] * Mathf.Rad2Deg);\n            }\n        }\n    }\n\n    void Update()\n    {\n        // Publish current Unity state (for visualization)\n        PublishUnityState();\n    }\n\n    void PublishUnityState()\n    {\n        // Get current joint states from Unity model\n        List<string> jointNames = new List<string>();\n        List<float> positions = new List<float>();\n        List<float> velocities = new List<float>();\n        List<float> efforts = new List<float>();\n\n        foreach (var kvp in jointMap)\n        {\n            jointNames.Add(kvp.Key);\n\n            // Convert Unity rotation back to joint position\n            float position = kvp.Value.localEulerAngles.z * Mathf.Deg2Rad;\n            positions.Add(position);\n\n            // Simplified velocity and effort (in practice, get from physics)\n            velocities.Add(0.0f);\n            efforts.Add(0.0f);\n        }\n\n        unityJointStatePublisher.Publish(jointNames.ToArray(), positions.ToArray(), velocities.ToArray(), efforts.ToArray());\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"hands-on-lab-unity-humanoid-robot-simulation",children:"Hands-on Lab: Unity Humanoid Robot Simulation"}),"\n",(0,o.jsx)(e.p,{children:"In this lab, you'll set up a basic Unity scene with a humanoid robot and ROS integration."}),"\n",(0,o.jsx)(e.h3,{id:"step-1-create-unity-project",children:"Step 1: Create Unity Project"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Open Unity Hub and create a new 3D project"}),"\n",(0,o.jsx)(e.li,{children:"Install the Unity Robotics Package via Package Manager"}),"\n",(0,o.jsx)(e.li,{children:"Import the ROS TCP Connector"}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"step-2-create-robot-model",children:"Step 2: Create Robot Model"}),"\n",(0,o.jsx)(e.p,{children:"Create a simple humanoid robot in Unity:"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:'Create an empty GameObject named "HumanoidRobot"'}),"\n",(0,o.jsxs)(e.li,{children:["Add child objects for each body part:","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Base (Cube)"}),"\n",(0,o.jsx)(e.li,{children:"Torso (Capsule)"}),"\n",(0,o.jsx)(e.li,{children:"Head (Sphere)"}),"\n",(0,o.jsx)(e.li,{children:"Arms and legs (Capsules)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"step-3-add-robot-controller-script",children:"Step 3: Add Robot Controller Script"}),"\n",(0,o.jsx)(e.p,{children:"Attach the UnityRobotController script to your robot:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\nusing RosSharp;\n\npublic class UnityRobotController : MonoBehaviour\n{\n    [Header("Robot Configuration")]\n    public string rosIPAddress = "127.0.0.1";\n    public int rosPort = 10000;\n\n    [Header("Robot Joints")]\n    public Transform leftHip;\n    public Transform leftKnee;\n    public Transform rightHip;\n    public Transform rightKnee;\n    public Transform leftShoulder;\n    public Transform leftElbow;\n    public Transform rightShoulder;\n    public Transform rightElbow;\n\n    private RosSocket rosSocket;\n    private JointStatePublisher jointStatePublisher;\n    private JointStateSubscriber jointStateSubscriber;\n\n    void Start()\n    {\n        // Initialize ROS connection\n        rosSocket = new RosSocket(new RosSharp.Communication.Protocol.WebSocket(rosIPAddress, rosPort));\n\n        // Initialize publishers and subscribers\n        jointStatePublisher = new JointStatePublisher(rosSocket, "/unity_joint_states");\n        jointStateSubscriber = new JointStateSubscriber(rosSocket, "/unity_joint_commands", OnJointCommandsReceived);\n    }\n\n    void Update()\n    {\n        // Publish current joint states\n        PublishJointStates();\n    }\n\n    void OnJointCommandsReceived(float[] positions)\n    {\n        // Apply joint commands to robot\n        if (positions.Length >= 8)\n        {\n            if (leftHip != null) leftHip.localRotation = Quaternion.Euler(0, 0, positions[0] * Mathf.Rad2Deg);\n            if (leftKnee != null) leftKnee.localRotation = Quaternion.Euler(0, 0, positions[1] * Mathf.Rad2Deg);\n            if (rightHip != null) rightHip.localRotation = Quaternion.Euler(0, 0, positions[2] * Mathf.Rad2Deg);\n            if (rightKnee != null) rightKnee.localRotation = Quaternion.Euler(0, 0, positions[3] * Mathf.Rad2Deg);\n            if (leftShoulder != null) leftShoulder.localRotation = Quaternion.Euler(positions[4] * Mathf.Rad2Deg, 0, 0);\n            if (leftElbow != null) leftElbow.localRotation = Quaternion.Euler(positions[5] * Mathf.Rad2Deg, 0, 0);\n            if (rightShoulder != null) rightShoulder.localRotation = Quaternion.Euler(positions[6] * Mathf.Rad2Deg, 0, 0);\n            if (rightElbow != null) rightElbow.localRotation = Quaternion.Euler(positions[7] * Mathf.Rad2Deg, 0, 0);\n        }\n    }\n\n    void PublishJointStates()\n    {\n        if (rosSocket == null) return;\n\n        // Get current joint positions\n        float[] positions = new float[8];\n        positions[0] = leftHip != null ? leftHip.localEulerAngles.z * Mathf.Deg2Rad : 0;\n        positions[1] = leftKnee != null ? leftKnee.localEulerAngles.z * Mathf.Deg2Rad : 0;\n        positions[2] = rightHip != null ? rightHip.localEulerAngles.z * Mathf.Deg2Rad : 0;\n        positions[3] = rightKnee != null ? rightKnee.localEulerAngles.z * Mathf.Deg2Rad : 0;\n        positions[4] = leftShoulder != null ? leftShoulder.localEulerAngles.x * Mathf.Deg2Rad : 0;\n        positions[5] = leftElbow != null ? leftElbow.localEulerAngles.x * Mathf.Deg2Rad : 0;\n        positions[6] = rightShoulder != null ? rightShoulder.localEulerAngles.x * Mathf.Deg2Rad : 0;\n        positions[7] = rightElbow != null ? rightElbow.localEulerAngles.x * Mathf.Deg2Rad : 0;\n\n        jointStatePublisher.Publish(positions);\n    }\n\n    void OnDestroy()\n    {\n        rosSocket?.Close();\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"step-4-create-a-ros-bridge-node",children:"Step 4: Create a ROS Bridge Node"}),"\n",(0,o.jsxs)(e.p,{children:["Create ",(0,o.jsx)(e.code,{children:"unity_bridge.py"})," to connect Unity with ROS 2:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom std_msgs.msg import String\nimport socket\nimport json\nimport threading\nimport time\n\nclass UnityBridge(Node):\n\n    def __init__(self):\n        super().__init__('unity_bridge')\n\n        # ROS publishers and subscribers\n        self.joint_state_publisher = self.create_publisher(JointState, '/unity_joint_states', 10)\n        self.joint_command_subscriber = self.create_subscription(\n            JointState, '/unity_joint_commands', self.joint_command_callback, 10)\n\n        # Unity connection\n        self.unity_socket = None\n        self.unity_connected = False\n        self.host = 'localhost'\n        self.port = 5005\n\n        # Start Unity connection thread\n        self.unity_thread = threading.Thread(target=self.unity_connection_loop)\n        self.unity_thread.daemon = True\n        self.unity_thread.start()\n\n        self.get_logger().info('Unity Bridge initialized')\n\n    def unity_connection_loop(self):\n        \"\"\"Main loop for Unity communication\"\"\"\n        server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n        server_socket.bind((self.host, self.port))\n        server_socket.listen(1)\n        self.get_logger().info(f'Unity Bridge listening on {self.host}:{self.port}')\n\n        while rclpy.ok():\n            try:\n                self.unity_socket, addr = server_socket.accept()\n                self.get_logger().info(f'Unity connected from {addr}')\n                self.unity_connected = True\n\n                while self.unity_connected and rclpy.ok():\n                    data = self.unity_socket.recv(1024).decode('utf-8')\n                    if data:\n                        self.process_unity_data(data)\n                    else:\n                        break\n\n            except Exception as e:\n                self.get_logger().error(f'Unity connection error: {str(e)}')\n                self.unity_connected = False\n                if self.unity_socket:\n                    self.unity_socket.close()\n\n            time.sleep(0.1)\n\n    def process_unity_data(self, data):\n        \"\"\"Process data received from Unity\"\"\"\n        try:\n            unity_data = json.loads(data)\n\n            if unity_data.get('type') == 'joint_states':\n                self.publish_joint_states(unity_data['data'])\n        except Exception as e:\n            self.get_logger().error(f'Error processing Unity data: {str(e)}')\n\n    def joint_command_callback(self, msg):\n        \"\"\"Send joint commands to Unity\"\"\"\n        if self.unity_connected and self.unity_socket:\n            try:\n                unity_cmd = {\n                    'type': 'joint_commands',\n                    'data': {\n                        'joint_names': list(msg.name),\n                        'positions': list(msg.position),\n                        'velocities': list(msg.velocity),\n                        'efforts': list(msg.effort)\n                    }\n                }\n                self.unity_socket.send(json.dumps(unity_cmd).encode('utf-8'))\n            except Exception as e:\n                self.get_logger().error(f'Error sending to Unity: {str(e)}')\n\n    def publish_joint_states(self, joint_data):\n        \"\"\"Publish joint states to ROS\"\"\"\n        msg = JointState()\n        msg.name = joint_data.get('joint_names', [])\n        msg.position = joint_data.get('positions', [])\n        msg.velocity = joint_data.get('velocities', [])\n        msg.effort = joint_data.get('efforts', [])\n        msg.header.stamp = self.get_clock().now().to_msg()\n\n        self.joint_state_publisher.publish(msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    unity_bridge = UnityBridge()\n\n    try:\n        rclpy.spin(unity_bridge)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        unity_bridge.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(e.h3,{id:"step-5-test-the-integration",children:"Step 5: Test the Integration"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Start the Unity Bridge:"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"python3 unity_bridge.py\n"})}),"\n",(0,o.jsxs)(e.ol,{start:"2",children:["\n",(0,o.jsx)(e.li,{children:"Run your Unity scene"}),"\n",(0,o.jsx)(e.li,{children:"Verify that joint states are being published and commands are being received"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Performance"}),": Balance visual quality with simulation performance"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Synchronization"}),": Ensure Unity and ROS states are properly synchronized"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Modularity"}),": Keep Unity and ROS components modular and independent"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Error Handling"}),": Implement robust error handling for network connections"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Validation"}),": Validate that Unity simulations match real-world expectations"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Documentation"}),": Document the Unity-ROS interface clearly"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsx)(e.p,{children:"After completing this chapter, you'll be ready to learn about environment building and scene creation in Chapter 6, where you'll explore creating complex simulation environments for humanoid robots."})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>s});var i=t(6540);const o={},r=i.createContext(o);function a(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:a(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);